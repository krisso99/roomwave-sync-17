
# Force content type for .ics files
<Files "*.ics">
  ForceType text/calendar
  Header set Content-Type "text/calendar; charset=utf-8"
  Header set Content-Disposition "attachment; filename=calendar.ics"
  Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
  Header set Pragma "no-cache"
  Header set Expires "0"
</Files>

# Set proper content type for PHP scripts that generate iCal
<Files "*.php">
  Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
  Header set Pragma "no-cache"
  Header set Expires "0"
</Files>

# Create property-specific iCal feeds with clean URLs
# This rewrites requests like property-123.ics to the generate.php script
RewriteEngine On
RewriteRule ^property-([^/]+)\.ics$ generate.php?propertyId=$1 [L]

# Fallback for room-specific feeds
RewriteRule ^room-([^/]+)-property-([^/]+)\.ics$ generate.php?roomId=$1&propertyId=$2 [L]

# Prevent caching of iCal feeds
<IfModule mod_headers.c>
  <FilesMatch "\.(ics|php)$">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>
</IfModule>
